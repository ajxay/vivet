<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Background with Foreground Image</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      }

      .video-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .video-container video {
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        object-fit: cover;
      }

      .opening-video-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        overflow: hidden;
        opacity: 0;
        transition: opacity 0.5s ease-in;
      }

      .opening-video-container.visible {
        opacity: 1;
      }

      .opening-video-container video {
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        object-fit: cover;
      }

      .opening-video-container.hidden {
        display: none;
      }

      .video-container.hidden {
        display: none;
      }

      .image-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1;
        opacity: 0;
        transition: opacity 1s ease-in;
        display: none;
      }

      .image-container.loaded {
        opacity: 1;
        display: block;
      }

      .image-container img {
        max-width: 70vw;
        max-height: 70vh;
        width: auto;
        height: auto;
      }

      .loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
        width: 300px;
        opacity: 1;
        transition: opacity 0.5s ease-out;
      }

      .loading.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .progress-bar-container {
        width: 100%;
        height: 1px;
        background-color: rgba(0, 0, 0, 0.2);
        position: relative;
      }

      .progress-bar-fill {
        height: 100%;
        background-color: black;
        width: 0%;
        transition: width 0.1s ease;
      }

      .menu-container {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 2;
        text-align: center;
        opacity: 0;
        transition: opacity 1s ease-in;
      }

      .menu-container.loaded {
        opacity: 1;
      }

      .menu-container.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .menu-line {
        width: 100px;
        height: 1px;
        background-color: black;
        margin: 0 auto 10px;
      }

      .menu-icon {
        width: 12px;
        height: 12px;
        margin: 0 auto 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .menu-icon svg {
        width: 12px;
        height: 12px;
      }

      .menu-icon svg path {
        fill: black !important;
      }

      .menu-text {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 14px;
        font-weight: bold;
        color: black;
        letter-spacing: 2px;
        text-transform: uppercase;
        cursor: pointer;
        transition: opacity 0.3s ease;
        margin: 0;
      }

      .menu-text:hover {
        opacity: 0.7;
      }

      .menu-line-bottom {
        width: 100px;
        height: 1px;
        background-color: black;
        margin: 10px auto 0;
      }

      .waitlist-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        display: none;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        opacity: 0;
        transition: opacity 0.3s ease, background-color 1.5s ease,
          backdrop-filter 1.5s ease, -webkit-backdrop-filter 1.5s ease;
      }

      .waitlist-modal.show {
        display: flex;
        opacity: 1;
      }

      .waitlist-modal.transitioning-out {
        background-color: rgba(0, 0, 0, 0);
        backdrop-filter: blur(0px);
        -webkit-backdrop-filter: blur(0px);
        opacity: 0;
      }

      .waitlist-form {
        background-color: transparent;
        padding: 40px 50px;
        border-radius: 8px;
        max-width: 600px;
        width: 90%;
        position: relative;
        opacity: 1;
        transition: opacity 0.5s ease;
      }

      .waitlist-modal.transitioning-out .waitlist-form {
        opacity: 0;
      }

      .waitlist-title {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 18px;
        font-weight: bold;
        color: white;
        text-transform: uppercase;
        text-align: center;
        letter-spacing: 1px;
        margin-bottom: 10px;
      }

      .waitlist-underline {
        width: 200px;
        height: 1px;
        background-color: white;
        margin: 0 auto 30px;
      }

      .waitlist-form-group {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }

      .waitlist-label {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 300;
        font-size: 18px;
        color: white;
        white-space: nowrap;
      }

      .waitlist-input {
        flex: 1;
        padding: 10px 15px;
        border: none;
        background-color: white;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 18px;
        color: black;
        border-radius: 4px;
      }

      .waitlist-input:focus {
        outline: 1px solid black;
      }

      .waitlist-send {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 16px;
        font-weight: 300;
        color: white;
        background: none;
        border: none;
        border-bottom: 1px solid white;
        cursor: pointer;
        padding: 10px 20px;
        transition: opacity 0.3s ease;
      }

      .waitlist-send:hover {
        opacity: 0.7;
      }

      .waitlist-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        color: white;
        cursor: pointer;
        line-height: 1;
        padding: 5px 10px;
        transition: opacity 0.3s ease;
      }

      .waitlist-close:hover {
        opacity: 0.7;
      }

      .carousel-arrows {
        position: fixed;
        top: 50%;
        transform: translateY(-50%);
        z-index: 3;
        display: none;
        opacity: 0;
        transition: opacity 0.1s ease;
      }

      .carousel-arrows.show {
        display: block;
        opacity: 1;
      }

      .carousel-arrow {
        background: transparent;
        border: 1px solid rgb(76, 75, 75);
        border-radius: 50%;
        color: black;
        font-size: 24px;
        cursor: pointer;
        width: 70px;
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        transition: opacity 0.3s ease;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 300;
        line-height: 2;
      }

      .carousel-arrow:hover {
        opacity: 0.7;
        backdrop-filter: blur(2px);
        -webkit-backdrop-filter: blur(2px);
      }

      .carousel-arrow-left {
        left: calc(50% - 35vw - 50px);
      }

      .carousel-arrow-right {
        right: calc(50% - 35vw - 50px);
      }
    </style>
  </head>
  <body>
    <div class="loading" id="loading">
      <div class="progress-bar-container">
        <div class="progress-bar-fill" id="progressBarFill"></div>
      </div>
    </div>

    <div class="opening-video-container" id="openingVideoContainer">
      <video id="openingVideo" muted playsinline loop preload="auto">
        <source src="./assets/videos/opening-video.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>

    <div class="video-container hidden" id="loopVideoContainer">
      <video id="bgVideo" autoplay muted loop playsinline>
        <!-- Replace with your video source -->
        <source src="./assets/videos/loop-video.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>

    <div class="image-container" id="imageContainer">
      <!-- Replace with your image source -->
      <img
        src="./assets/image%209.png"
        alt="Foreground Image"
        id="foregroundImage"
      />
    </div>

    <div class="carousel-arrows carousel-arrow-left" id="carouselArrowLeft">
      <button class="carousel-arrow" id="prevArrow">←</button>
    </div>

    <div class="carousel-arrows carousel-arrow-right" id="carouselArrowRight">
      <button class="carousel-arrow" id="nextArrow">→</button>
    </div>

    <div class="menu-container" id="menuContainer">
      <!-- <div class="menu-line"></div> -->
      <div class="menu-icon">
        <svg
          width="12"
          height="12"
          viewBox="0 0 12 12"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M6 1C4.61929 1 3.5 2.11929 3.5 3.5V4.5H2V11H10V4.5H8.5V3.5C8.5 2.11929 7.3807 1 6 1ZM7.5 4.5V3.5C7.5 2.67158 6.82845 2 6 2C5.17155 2 4.5 2.67158 4.5 3.5V4.5H7.5ZM6.5 6.5V9H5.5V6.5H6.5Z"
          />
        </svg>
      </div>
      <div class="menu-text" id="openJournal">OPEN JOURNAL</div>
      <div class="menu-line-bottom"></div>
    </div>

    <div class="waitlist-modal" id="waitlistModal">
      <div class="waitlist-form">
        <button class="waitlist-close" id="closeWaitlist">&times;</button>
        <div class="waitlist-title">JOIN THE WAITLIST</div>
        <div class="waitlist-underline"></div>
        <form id="waitlistForm">
          <div class="waitlist-form-group">
            <label class="waitlist-label" for="email">Your email address</label>
            <input
              type="email"
              id="email"
              class="waitlist-input"
              placeholder="john.doe@gmail.com"
              required
            />
            <button type="submit" class="waitlist-send">Send</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      window.addEventListener("DOMContentLoaded", function () {
        const openingVideo = document.getElementById("openingVideo");
        const openingVideoContainer = document.getElementById(
          "openingVideoContainer"
        );
        const loopVideo = document.getElementById("bgVideo");
        const loopVideoContainer =
          document.getElementById("loopVideoContainer");
        const imageContainer = document.getElementById("imageContainer");
        const loading = document.getElementById("loading");
        const progressBarFill = document.getElementById("progressBarFill");
        const image = document.getElementById("foregroundImage");
        const menuContainer = document.getElementById("menuContainer");

        let videoLoaded = false;
        let progressInterval;

        // Track video loading progress
        function updateProgress() {
          if (openingVideo.duration > 0 && !isNaN(openingVideo.duration)) {
            let totalBuffered = 0;

            // Check all buffered ranges to get total buffered time
            if (openingVideo.buffered.length > 0) {
              for (let i = 0; i < openingVideo.buffered.length; i++) {
                totalBuffered +=
                  openingVideo.buffered.end(i) - openingVideo.buffered.start(i);
              }
            }

            const duration = openingVideo.duration;
            const percent = (totalBuffered / duration) * 100;
            const progress = Math.min(Math.max(percent, 0), 100);
            progressBarFill.style.width = progress + "%";

            console.log(
              "Progress:",
              progress.toFixed(2) + "%",
              "ReadyState:",
              openingVideo.readyState,
              "Buffered ranges:",
              openingVideo.buffered.length
            );

            // Check if video is fully loaded - must be very close to 100%
            // Also check if the last buffered range covers the entire duration
            let isFullyBuffered = false;
            if (openingVideo.buffered.length > 0) {
              const lastRangeEnd = openingVideo.buffered.end(
                openingVideo.buffered.length - 1
              );
              const firstRangeStart = openingVideo.buffered.start(0);
              // Check if buffering starts at 0 and ends at or near the duration
              isFullyBuffered =
                firstRangeStart <= 0.1 && lastRangeEnd >= duration * 0.99;
            }

            if (
              (progress >= 99 || isFullyBuffered) &&
              !videoLoaded &&
              openingVideo.readyState >= 4
            ) {
              videoLoaded = true;
              if (progressInterval) {
                clearInterval(progressInterval);
              }
              // Ensure we're at 100%
              progressBarFill.style.width = "100%";
              console.log("Video fully loaded! Starting playback...");
              playVideoAfterLoad();
            }
          } else if (openingVideo.readyState >= 2) {
            // If we have metadata but no duration yet, show some progress
            const readyStatePercent = (openingVideo.readyState / 4) * 50; // Max 50% until we have duration
            progressBarFill.style.width = readyStatePercent + "%";
          }
        }

        // Set up progress tracking
        openingVideo.addEventListener("loadstart", function () {
          console.log("Video load started");
          progressBarFill.style.width = "0%";
        });

        openingVideo.addEventListener("loadedmetadata", function () {
          console.log(
            "Video metadata loaded, duration:",
            openingVideo.duration
          );
          updateProgress();
        });

        openingVideo.addEventListener("progress", function () {
          updateProgress();
        });

        // Also update progress periodically
        progressInterval = setInterval(function () {
          if (!videoLoaded) {
            updateProgress();
          }
        }, 100);

        // Wait for video to be fully loaded before playing
        // Only use canplaythrough as a backup, not primary trigger
        openingVideo.addEventListener("canplaythrough", function () {
          console.log(
            "Video can play through, but checking actual progress..."
          );
          // Don't trigger play here - let progress tracking handle it
          // This is just to ensure we have enough data
        });

        function playVideoAfterLoad() {
          console.log(
            "playVideoAfterLoad called, readyState:",
            openingVideo.readyState
          );

          // Ensure progress bar is at 100%
          progressBarFill.style.width = "100%";

          setTimeout(function () {
            // Hide progress bar first
            loading.classList.add("hidden");

            // Show video container
            openingVideoContainer.classList.add("visible");

            // Wait a moment for container to be visible
            setTimeout(function () {
              // Ensure video is loaded and ready
              if (openingVideo.readyState >= 3) {
                // Try to play the video
                const playPromise = openingVideo.play();

                if (playPromise !== undefined) {
                  playPromise
                    .then(function () {
                      console.log("Opening video started playing successfully");
                      console.log(
                        "Video paused:",
                        openingVideo.paused,
                        "Current time:",
                        openingVideo.currentTime
                      );

                      // Show menu after opening video starts
                      setTimeout(function () {
                        menuContainer.classList.add("loaded");
                      }, 500);
                    })
                    .catch(function (error) {
                      console.log("Opening video autoplay prevented:", error);
                      // Try again after a short delay
                      setTimeout(function () {
                        openingVideo.play().catch(function (err) {
                          console.log("Second play attempt failed:", err);
                        });
                      }, 500);
                      // Still show menu
                      setTimeout(function () {
                        menuContainer.classList.add("loaded");
                      }, 1000);
                    });
                } else {
                  // Fallback for older browsers
                  openingVideo.play();
                  setTimeout(function () {
                    menuContainer.classList.add("loaded");
                  }, 500);
                }
              } else {
                console.log(
                  "Video not ready yet, readyState:",
                  openingVideo.readyState
                );
                // Wait a bit more and try again
                setTimeout(function () {
                  openingVideo
                    .play()
                    .then(function () {
                      menuContainer.classList.add("loaded");
                    })
                    .catch(function (error) {
                      console.log("Play failed:", error);
                      menuContainer.classList.add("loaded");
                    });
                }, 500);
              }
            }, 200);
          }, 300);
        }

        // No fallback - we MUST wait for video to fully load
        // The video is essential, so we wait as long as needed

        // Handle opening video errors
        openingVideo.addEventListener("error", function () {
          console.log("Opening video failed to load");
          menuContainer.classList.add("loaded");
          loading.classList.add("hidden");
        });

        // Load loop video when OPEN JOURNAL is clicked
        loopVideo.addEventListener("loadeddata", function () {
          loopVideo.play().catch(function (error) {
            console.log("Loop video autoplay prevented:", error);
          });
        });

        // Add click handler for OPEN JOURNAL
        const openJournal = document.getElementById("openJournal");
        const waitlistModal = document.getElementById("waitlistModal");
        const closeWaitlist = document.getElementById("closeWaitlist");
        const waitlistForm = document.getElementById("waitlistForm");

        // Function to close modal with smooth transition (without submitting)
        function closeModalWithTransition() {
          waitlistModal.classList.add("transitioning-out");

          setTimeout(function () {
            waitlistModal.classList.remove("show");
            waitlistModal.classList.remove("transitioning-out");
            // Reset image back to original and show menu
            // image.src = './assets/image%209.png';
            menuContainer.classList.remove("hidden");
          }, 1500); // Match the transition duration
        }

        openJournal.addEventListener("click", function () {
          // Hide opening video and show loop video + image
          openingVideoContainer.classList.add("hidden");
          loopVideoContainer.classList.remove("hidden");

          // Change image to page 1-2.jpg and show it
          image.src = "./assets/page%201-2.jpg";
          imageContainer.classList.add("loaded");

          // Show modal
          waitlistModal.classList.add("show");
          menuContainer.classList.add("hidden");
        });

        closeWaitlist.addEventListener("click", function () {
          closeModalWithTransition();
        });

        // Close modal when clicking outside
        waitlistModal.addEventListener("click", function (e) {
          if (e.target === waitlistModal) {
            closeModalWithTransition();
          }
        });

        // Carousel functionality
        const carouselImages = [
          "./assets/carousel-images/image1.jpg",
          "./assets/carousel-images/image2.png",
          "./assets/carousel-images/image3.png",
          "./assets/carousel-images/image4.png",
          "./assets/carousel-images/image5.png",
        ];
        let currentImageIndex = 0;
        const carouselArrowLeft = document.getElementById("carouselArrowLeft");
        const carouselArrowRight =
          document.getElementById("carouselArrowRight");
        const prevArrow = document.getElementById("prevArrow");
        const nextArrow = document.getElementById("nextArrow");

        function updateCarouselImage() {
          if (carouselImages[currentImageIndex]) {
            image.src = carouselImages[currentImageIndex];
          }
        }

        function showCarousel() {
          carouselArrowLeft.classList.add("show");
          carouselArrowRight.classList.add("show");
        }

        function hideCarousel() {
          carouselArrowLeft.classList.remove("show");
          carouselArrowRight.classList.remove("show");
        }

        prevArrow.addEventListener("click", function () {
          if (currentImageIndex > 0) {
            currentImageIndex--;
            updateCarouselImage();
          }
        });

        nextArrow.addEventListener("click", function () {
          if (currentImageIndex < carouselImages.length - 1) {
            currentImageIndex++;
            updateCarouselImage();
          }
        });

        // Handle form submission
        waitlistForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const email = document.getElementById("email").value;
          console.log("Email submitted:", email);
          // Add your form submission logic here

          // Start smooth transition
          waitlistModal.classList.add("transitioning-out");
          menuContainer.classList.add("hidden");

          // Wait for transition to complete, then close modal and show carousel
          setTimeout(function () {
            waitlistModal.classList.remove("show");
            waitlistModal.classList.remove("transitioning-out");
            currentImageIndex = 0;
            updateCarouselImage();
            showCarousel();
          }, 1000); // Match the transition duration
        });
      });
    </script>
  </body>
</html>
